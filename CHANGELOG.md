# 采购清单系统更新日志

## 2024-02-28 - 采购清单系统重构

### ✨ 新功能

1. **完整的采购清单系统**
   - 实现了完整的购物车流程（决策 → 管理 → 结算 → 追溯）
   - 支持从食材区、储物区、菜谱区添加食材到购物车
   - 支持单个/批量移除购物车中的食材
   - 支持一键确认购买并自动入库

2. **新增 API 接口**
   - `GET /api/purchase/plan` - 获取缺失食材建议
   - `POST /api/purchase/cart/add` - 将食材加入购物车
   - `GET /api/purchase/cart` - 查看当前购物车
   - `DELETE /api/purchase/cart/item/{id}` - 从购物车移除食材
   - `POST /api/purchase/cart/confirm` - 确认购买并入库
   - `GET /api/purchase/orders` - 获取历史订单列表
   - `GET /api/purchase/orders/{id}` - 查看订单详情
   - `DELETE /api/purchase/orders/{id}` - 删除历史订单

### 🔧 修复

1. **购物车刷新问题**
   - 添加/删除食材后自动刷新购物车
   - 使用 `refreshShoppingList()` 统一刷新逻辑

2. **删除储物区食材问题**
   - 修复了删除单个食材时误删全部的 bug
   - 优化了 `useEffect` 依赖项，移除了 `inventory` 依赖

3. **菜谱添加提示问题**
   - 修复了添加菜谱时提示数量错误的问题
   - 正确显示实际添加的食材数量

### 🗑️ 移除

1. **删除 Mock 数据**
   - 移除了所有 Mock 数据（`mockInventory`, `mockRecipes`, `mockIngredients`）
   - 移除了 `useMockData` 状态和相关逻辑
   - 移除了 `manualShoppingList` 手动购物清单状态
   - 系统现在完全依赖后端 API

2. **简化购物清单显示**
   - 移除了"用于菜谱"标签显示
   - 购物车界面更加简洁

### 📝 代码优化

1. **统一数据流**
   - 所有操作都通过后端 API 完成
   - 操作后统一调用 `loadData()` 或 `refreshShoppingList()` 刷新数据

2. **简化状态管理**
   - 移除了不必要的本地状态
   - 购物清单完全由后端购物车驱动

3. **改进错误处理**
   - 网络错误时显示明确的错误提示
   - 不再自动回退到 Mock 数据

## 使用说明

### 购物车工作流程

1. **添加食材到购物车**
   - 食材区：点击食材卡片上的购物车图标
   - 储物区：点击食材卡片上的购物车图标
   - 菜谱区：点击菜谱卡片上的"加入购物清单"按钮

2. **管理购物车**
   - 切换到"购物清单"标签页查看
   - 单个移除：点击食材卡片上的"移除"按钮
   - 批量移除：点击"批量管理"，选择食材后点击"批量移除"

3. **确认购买**
   - 点击"确认购买并入库"按钮
   - 系统自动将食材添加到储物区
   - 购物车自动清空

### 技术要点

- 购物车状态完全由后端管理（DRAFT 状态的订单）
- 前端通过 `getCart()` 获取购物车内容
- 添加/删除操作后自动调用 `refreshShoppingList()` 刷新
- 确认购买后调用 `confirmCartPurchase()` 完成入库

## 依赖要求

- 后端 API 必须正常运行
- 所有接口必须按照 API 规范实现
- 建议后端 URL: `http://localhost:8080`

## 已知问题

无

## 下一步计划

1. 添加历史订单查看功能
2. 支持输入采购总价
3. 支持订单备注编辑
4. 添加采购统计分析

