# 前后端联调测试计划

## 📋 测试前准备

### 1. 环境配置
- [ ] 确保后端服务运行在 `http://localhost:8080`
- [ ] 创建 `.env` 文件（参考 `.env.example`）
- [ ] 前端开发服务器运行在 `http://localhost:5173`

### 2. 数据准备
- [ ] 后端数据库已初始化
- [ ] 有基础的食材数据（至少5-10种）
- [ ] 有基础的菜谱数据（至少3-5个）

---

## 🧪 测试场景

### 场景一：基础数据加载测试

#### 测试步骤：
1. 启动后端服务
2. 启动前端服务
3. 打开浏览器访问前端页面
4. **取消勾选**"测试数据"复选框，切换到真实API模式

#### 预期结果：
- ✅ 页面正常加载，无报错
- ✅ 储物区显示后端返回的库存数据
- ✅ 菜谱区显示后端返回的菜谱列表
- ✅ 如果后端无数据，显示空状态提示

#### 检查点：
- 网络请求是否成功（F12 Network 查看）
- 数据格式是否正确
- 错误处理是否生效

---

### 场景二：菜谱选择与购物清单生成

#### 测试步骤：
1. 切换到"菜谱区"标签页
2. 选择2-3个菜谱（点击卡片）
3. 切换到"购物清单"标签页

#### 预期结果：
- ✅ 选中的菜谱卡片有紫色边框和勾选标记
- ✅ 购物清单显示所需购买的食材
- ✅ 食材列表显示"用于菜谱"标签
- ✅ 已在库存中的食材不会出现在购物清单

#### 检查点：
- 购物清单计算逻辑是否正确
- 调料是否根据"忽略调料"开关正确显示/隐藏
- 购物清单数量徽章是否正确

---

### 场景三：确认购买并入库

#### 测试步骤：
1. 在购物清单页面，确保有待购买的食材
2. 点击"确认购买并入库"按钮
3. 切换到"储物区"标签页

#### 预期结果：
- ✅ 显示"购买成功"提示
- ✅ 后端API `/api/purchase/confirm` 被调用
- ✅ 储物区新增购买的食材
- ✅ 购物清单被清空
- ✅ 菜谱选择状态被重置

#### 检查点：
- 后端是否正确创建库存记录
- 过期日期是否根据保质期正确计算
- 储存方式是否正确设置

---

### 场景四：库存管理与过期提醒

#### 测试步骤：
1. 在储物区查看所有食材
2. 使用筛选器切换不同储存方式
3. 点击"快过期"筛选器
4. 切换到购物清单页面查看顶部预警区

#### 预期结果：
- ✅ 筛选器正确过滤食材
- ✅ 快过期食材（3天内）被正确标记
- ✅ 购物清单页面顶部显示临期预警
- ✅ 剩余天数计算正确
- ✅ 新鲜度进度条显示正确

#### 检查点：
- 日期计算逻辑是否准确
- 颜色标记是否符合规则（红色≤3天，黄色≤7天，绿色>7天）
- 过期食材是否半透明显示

---

### 场景五：食材分类与搜索

#### 测试步骤：
1. 在储物区使用分类筛选器
2. 观察不同分类的食材
3. 检查食材的分类标签颜色

#### 预期结果：
- ✅ 分类筛选正确工作
- ✅ 食材数量统计准确
- ✅ 分类标签颜色正确：
  - 水果：橙色
  - 蔬菜：绿色
  - 肉类：红色
  - 碳水：黄色
  - 调料：紫色

---

### 场景六：响应式布局测试

#### 测试步骤：
1. 调整浏览器窗口大小
2. 使用开发者工具切换到移动设备视图
3. 测试所有功能

#### 预期结果：
- ✅ 移动端布局正常显示
- ✅ 筛选器可横向滚动
- ✅ 卡片网格自适应调整
- ✅ 按钮和文字大小适配
- ✅ 触摸操作流畅

---

### 场景七：错误处理测试

#### 测试步骤：
1. 关闭后端服务
2. 刷新前端页面
3. 尝试进行各种操作

#### 预期结果：
- ✅ 显示友好的错误提示
- ✅ 自动降级到Mock数据（如果配置）
- ✅ 不会出现白屏或崩溃
- ✅ 控制台有清晰的错误日志

---

## 🔍 API接口测试清单

### 食材管理
- [ ] `GET /api/ingredients` - 获取食材列表
- [ ] `GET /api/ingredients?category=蔬菜` - 按分类筛选
- [ ] `GET /api/ingredients/search?keyword=猪` - 搜索食材

### 菜谱管理
- [ ] `GET /api/recipes/list` - 获取菜谱列表
- [ ] `GET /api/recipes/list?keyword=宫保` - 搜索菜谱
- [ ] `GET /api/recipes/{id}` - 获取菜谱详情
- [ ] `GET /api/recipes/{id}/check` - 检查菜谱是否可做

### 库存管理
- [ ] `GET /api/inventory/list` - 获取库存列表
- [ ] `POST /api/inventory/add` - 添加库存
- [ ] `DELETE /api/inventory/consume/{ingredientId}` - 消耗食材
- [ ] `DELETE /api/inventory/{id}` - 删除库存条目
- [ ] `GET /api/inventory/expiring?days=3` - 查询临期食材
- [ ] `GET /api/inventory/expired` - 查询过期食材
- [ ] `PUT /api/inventory/update` - 更新库存

### 购买管理
- [ ] `GET /api/purchase/plan?recipeIds=1,2,3` - 生成购买计划
- [ ] `POST /api/purchase/confirm` - 确认购买并入库

---

## 🐛 常见问题排查

### 问题1：CORS跨域错误
**现象**：浏览器控制台显示CORS错误  
**解决**：后端需要配置CORS允许前端域名

### 问题2：数据格式不匹配
**现象**：数据显示异常或undefined  
**解决**：检查后端返回的字段名是否与前端类型定义一致

### 问题3：日期格式问题
**现象**：日期显示错误或NaN  
**解决**：确保后端返回 `YYYY-MM-DD` 格式的日期字符串

### 问题4：图片加载失败
**现象**：食材图片显示不出来  
**解决**：检查 `imageUrl` 字段是否有效，前端有降级处理

### 问题5：购买后数据未刷新
**现象**：购买成功但储物区没有新数据  
**解决**：检查 `loadData()` 是否被正确调用

---

## ✅ 测试完成标准

- [ ] 所有API接口调用成功
- [ ] 数据正确显示和更新
- [ ] 错误处理正常工作
- [ ] 响应式布局在各设备正常
- [ ] 无控制台错误或警告
- [ ] 用户体验流畅，无明显卡顿

---

## 📝 测试记录模板

```
测试日期：____年__月__日
测试人员：________
后端版本：________
前端版本：________

| 测试场景 | 测试结果 | 问题描述 | 备注 |
|---------|---------|---------|------|
| 场景一   | ✅/❌   |         |      |
| 场景二   | ✅/❌   |         |      |
| ...     | ...     | ...     | ...  |
```

---

## 🚀 下一步优化建议

1. **性能优化**
   - 添加数据缓存机制
   - 实现虚拟滚动（大量数据时）
   - 图片懒加载优化

2. **功能增强**
   - 添加食材编辑功能
   - 支持批量操作
   - 添加购买历史记录
   - 实现数据导出功能

3. **用户体验**
   - 添加加载骨架屏
   - 优化动画效果
   - 添加操作确认对话框
   - 支持撤销操作

4. **数据可视化**
   - 添加食材消耗统计图表
   - 显示购买趋势分析
   - 过期食材统计报表


